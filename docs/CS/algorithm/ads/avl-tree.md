## AVL tree

### å®šä¹‰

ç›®æ ‡ï¼šä¿è¯æ¯æ¬¡æ“ä½œæ—¶é—´æ˜¯ $O(\log n)$

0. ç©ºæ ‘æ˜¯ height balanced çš„
1. å·¦å³å­æ ‘éƒ½ height balancedï¼š**é€’å½’ä¸‹å»æ‰€æœ‰éƒ½æ˜¯**
2. $|h_L - h_r| \le 1$ï¼Œå³å¯¹æ‰€æœ‰èŠ‚ç‚¹ $BF(node) = -1 / 0 / 1$ï¼Œ


!!! info ""

    å®šä¹‰  $BF(node) = h_L - h_R$

### æ—‹è½¬ï¼ˆæ ¸å¿ƒï¼‰

!!! abstract "è¯¾ä¸‹æ€»ç»“"

    - å¯¹äº LR å’Œ RLï¼ŒæŒ‰ç…§ä» trouble maker åˆ° trouble finder çš„èµ°åŠ¿ï¼Œå†³å®šé¡ºé€†æ—¶é’ˆã€‚
        - å¾€å³æ’‡ï¼Œé¡ºæ—¶é’ˆ
        - å¾€å·¦æ’‡ï¼Œé€†æ—¶é’ˆ
    - åªæ—‹è½¬ trouble makerï¼ŒæŒ‰ç…§åˆšåˆšçš„é¡ºé€†æ—¶é’ˆ

**ä¸€å¥è¯ï¼Œæ¯æ¬¡æ’å…¥ / åˆ é™¤ï¼Œå¸¦æ¥ BF çš„å˜åŒ–ï¼Œå°±è¦çœ‹éœ€ä¸éœ€è¦æ—‹è½¬ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œçœ‹ä» trouble maker åˆ° trouble finder è¿™æ¡è·¯ä¸Šçš„æƒ…å†µï¼Œå†³å®šæ€æ ·æ—‹è½¬**

#### è§„å¾‹

**å‘½åæ¥ç”±**ï¼ˆLL / LR / RR / RLï¼‰ï¼š

- trouble makerï¼šæ’å…¥/åˆ é™¤ç‚¹
- trouble finderï¼šå¤±è¡¡èŠ‚ç‚¹

ä» trouble finder çœ‹ trouble maker åœ¨å“ªè¾¹çš„å“ªè¾¹ï¼Œåªæ•°ä¸‰ä¸ªèŠ‚ç‚¹ï¼ˆåŒ…å«å¤´å°¾ï¼Œä¹Ÿå°±æ˜¯ä¸­é—´ç»è¿‡ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼šLä»£è¡¨å·¦å­æ ‘ï¼ŒRä»£è¡¨å³å­æ ‘

- LLï¼šå·¦å­æ ‘çš„å·¦å­æ ‘æ’å…¥
- LRï¼šå·¦å­æ ‘çš„å³å­æ ‘æ’å…¥
- RRï¼šå³å­æ ‘çš„å³å­æ ‘æ’å…¥
- RLï¼šå³å­æ ‘çš„å·¦å­æ ‘æ’å…¥


#### RR rotate
![alt text](res/images/image.png)

1. trouble maker: $B_R$ï¼Œå³å­æ ‘çš„å³å­æ ‘æ’å…¥
2. trouble finderï¼ˆæ­¤å¤„æ˜¯Aï¼‰ï¼šä»æ’å…¥/åˆ é™¤ç‚¹å¾€ä¸Šå›æº¯
3. å±€éƒ¨è°ƒæ•´ï¼Œæ•´ä½“èµ·æ•ˆï¼šä¸€èˆ¬ AVL è°ƒæ•´åªéœ€è¦å¤„ç† ç¦»æ’å…¥ç‚¹æœ€è¿‘çš„ã€æœ€åº•å±‚çš„å¤±è¡¡èŠ‚ç‚¹ï¼ˆå³ç¬¬ä¸€ä¸ª finderï¼‰ï¼Œå³æ­¤å¤„ A æ²¡å¿…è¦æ˜¯æ ¹èŠ‚ç‚¹
4. è°ƒæ•´è¿‡ç¨‹ä¿æŒ äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†ç»“æœä¸å˜ï¼Œå³è¿™é‡Œ $B_L$ å˜æˆ A çš„å³å­æ ‘

#### LL rotate

![alt text](res/images/image-1.png)

#### LR rotate

![alt text](res/images/image-3.png)


æ—‹è½¬æ–¹æ³•ï¼šåç€è½¬ï¼Œå…ˆå³åå·¦

- å·¦ï¼šå·¦å­æ ‘ï¼Œå³ trouble finder çš„å·¦å­æ ‘
- å³ï¼šå³å­æ ‘ï¼Œå³ trouble finder çš„å·¦å­æ ‘çš„å³å­æ ‘

å³ï¼šæŠŠä» trouble maker å’Œä»ä»–å¼€å§‹åˆ° trouble finder çš„è·¯å¾„ä¸Šå‰ä¸‰ä¸ªèŠ‚ç‚¹å‘å·¦æ—‹è½¬ï¼ˆé€†æ—¶é’ˆï¼‰

å·¦ï¼šæ—‹è½¬åŸæ¥çš„ trouble finder èŠ‚ç‚¹ï¼Œå‘å³æ—‹è½¬ï¼ˆé¡ºæ—¶é’ˆï¼‰

#### RL rotate

![alt text](res/images/image-2.png)

åŸºæœ¬åŒä¸Šï¼Œå˜ä¸€ä¸‹é¡ºåº

### æ•°æ®å­˜å‚¨

### å¤æ‚åº¦
![alt text](res/images/image-4.png)

$n_h$ ä¸ºé«˜åº¦ä¸º h çš„ AVL æ ‘çš„æœ€å°èŠ‚ç‚¹æ•°ï¼Œç”±äºæ˜¯æœ€å°ï¼Œåˆ™ root çš„å·¦å³å­æ ‘é«˜åº¦å·®1ï¼ˆç›¸ç­‰çš„è¯å·¦ / å³å‡å»ä¸€ä¸ªè¿˜æ˜¯ AVL æ ‘ï¼‰

$$n_h = 1 + n_{h-1} + n_{h-2}$$

æ¯ä¸€æ­¥æ“ä½œéƒ½æ˜¯ $O(\log n)$

- æ’å…¥ï¼š$O(\log n)$
- åˆ é™¤ï¼š$O(\log n)$
- æŸ¥æ‰¾ï¼š$O(\log n)$


## Splay Tree

???- info "Splay çŸ¥è¯†ç‚¹å…¨è§£"

    ## ğŸ§© ä¸€ã€ä»€ä¹ˆæ˜¯ Splay Treeï¼ˆä¼¸å±•æ ‘ï¼‰

    **Splay Treeï¼ˆä¼¸å±•æ ‘ï¼‰** æ˜¯ä¸€ç§**è‡ªè°ƒæ•´çš„äºŒå‰æœç´¢æ ‘ï¼ˆSelf-adjusting Binary Search Treeï¼‰**ï¼Œç”± **Daniel Sleator** å’Œ **Robert Tarjan** åœ¨ 1985 å¹´æå‡ºã€‚

    å®ƒä¸ AVL Treeã€Red-Black Tree ä¸€æ ·éƒ½æ˜¯**äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰**ï¼Œä½†**ä¸ç»´æŠ¤ä¸¥æ ¼çš„å¹³è¡¡ä¿¡æ¯**ï¼ˆå¦‚é«˜åº¦æˆ–é¢œè‰²ï¼‰ã€‚
    å–è€Œä»£ä¹‹ï¼Œå®ƒé€šè¿‡ä¸€ç§ç§°ä¸º **Splayingï¼ˆä¼¸å±•ï¼‰** çš„æ“ä½œï¼Œä½¿å¾—**æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹è¢«ç§»åŠ¨åˆ°æ ‘æ ¹**ã€‚

    > ğŸ“– ç›´è§‚ç†è§£ï¼š
    > Splay Tree å°±åƒä¸€ä¸ªâ€œä¼šè‡ªå·±è®°å¿†ä½¿ç”¨ä¹ æƒ¯â€çš„ BSTã€‚
    > ä½ å¸¸è®¿é—®å“ªä¸ªèŠ‚ç‚¹ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨é è¿‘æ ¹ï¼Œè®©ä»¥åè®¿é—®æ›´å¿«ã€‚

    ---

    ## âš™ï¸ äºŒã€Splay Tree çš„æ ¸å¿ƒæ€æƒ³

    æ¯å½“æ‰§è¡Œä¸€æ¬¡æ“ä½œï¼ˆå¦‚æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ï¼‰ï¼Œæˆ‘ä»¬éƒ½ä¼šæŠŠ**è®¿é—®åˆ°çš„èŠ‚ç‚¹ä¼¸å±•ï¼ˆsplayï¼‰åˆ°æ ¹èŠ‚ç‚¹**ã€‚

    ä¼¸å±•çš„å¥½å¤„æ˜¯ï¼š

    * **æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹æ›´é è¿‘æ ¹**ï¼›
    * **å±€éƒ¨æ€§åŸåˆ™ï¼ˆlocalityï¼‰**ï¼šè‹¥æœªæ¥è®¿é—®ç›¸åŒæˆ–é‚»è¿‘çš„èŠ‚ç‚¹ï¼Œé€Ÿåº¦ä¼šæ›´å¿«ï¼›
    * **æ‘Šè¿˜æ—¶é—´å¤æ‚åº¦ä¸º O(log n)**ã€‚

    ---

    ## ğŸªœ ä¸‰ã€Splay æ“ä½œï¼ˆSplayingï¼‰

    ### 1ï¸âƒ£ å®šä¹‰

    â€œSplayâ€ æ˜¯ä¸€ç§é€šè¿‡**æ—‹è½¬ï¼ˆrotationï¼‰**å°†èŠ‚ç‚¹é€æ­¥ç§»åŠ¨åˆ°æ ¹èŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚

    è®¾è¦ä¼¸å±•çš„èŠ‚ç‚¹ä¸º `x`ï¼Œå…¶çˆ¶èŠ‚ç‚¹ä¸º `p`ï¼Œç¥–çˆ¶èŠ‚ç‚¹ä¸º `g`ã€‚
    æ ¹æ® `x` åœ¨æ ‘ä¸­çš„ä½ç½®ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š

    ---

    ### 2ï¸âƒ£ ä¸‰ç§æƒ…å†µè¯¦è§£

    #### **ï¼ˆ1ï¼‰Zigï¼ˆå•æ—‹è½¬ï¼‰**

    å½“ `x` æ˜¯æ ¹çš„**ç›´æ¥å­©å­**æ—¶ï¼ˆå³æ²¡æœ‰ç¥–çˆ¶èŠ‚ç‚¹ï¼‰ï¼š

    * è‹¥ `x` æ˜¯å·¦å­©å­ â†’ å³æ—‹ï¼›
    * è‹¥ `x` æ˜¯å³å­©å­ â†’ å·¦æ—‹ã€‚

    ```text
        p                x
    /                / \
    x      â†’         a   p
    / \                  / \
    a   b                b   c
    ```

    ---

    #### **ï¼ˆ2ï¼‰Zig-Zigï¼ˆåŒæ—‹è½¬ï¼ŒåŒå‘ï¼‰**

    å½“ `x` å’Œ `p` **åœ¨åŒä¸€æ–¹å‘**ï¼ˆéƒ½æ˜¯å·¦å­©å­æˆ–éƒ½æ˜¯å³å­©å­ï¼‰æ—¶ï¼š

    * å…ˆå¯¹ `g` æ—‹è½¬ï¼›
    * å†å¯¹ `p` æ—‹è½¬ã€‚

    ä¾‹å¦‚ï¼š`x`ã€`p` éƒ½æ˜¯å·¦å­©å­ï¼š

    ```text
        g                     x
        /                     / \
        p         â†’           a   p
    / \                       / \
    x   c                     b   g
    / \                           / \
    a   b                         c   d
    ```

    ---

    #### **ï¼ˆ3ï¼‰Zig-Zagï¼ˆåŒæ—‹è½¬ï¼Œäº¤å‰æ–¹å‘ï¼‰**

    å½“ `x` å’Œ `p` **æ–¹å‘ç›¸å**æ—¶ï¼š

    * å…ˆå¯¹ `p` æ—‹è½¬ï¼›
    * å†å¯¹ `g` æ—‹è½¬ã€‚

    ä¾‹å¦‚ï¼š`x` æ˜¯å³å­©å­ï¼Œ`p` æ˜¯å·¦å­©å­ï¼š

    ```text
        g                     x
        /                     / \
        p         â†’           p   g
    / \                   / \ / \
    a   x                 a  b c  d
        / \
        b   c
    ```

    ---

    ## ğŸŒ± å››ã€åŸºæœ¬æ“ä½œ

    Splay Tree çš„æ‰€æœ‰æ“ä½œï¼ˆæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ï¼‰éƒ½åŸºäºâ€œå…ˆ splayï¼Œå†è°ƒæ•´â€ï¼š

    ---

    ### **1ï¸âƒ£ æŸ¥æ‰¾ï¼ˆSearchï¼‰**

    æŸ¥æ‰¾é”® `k`ï¼š

    * åƒæ™®é€š BST ä¸€æ ·æŸ¥æ‰¾ï¼›
    * è‹¥æ‰¾åˆ°èŠ‚ç‚¹ `x` â†’ **å°† `x` ä¼¸å±•åˆ°æ ¹**ï¼›
    * è‹¥æ²¡æ‰¾åˆ° â†’ **å°†æœ€åè®¿é—®çš„èŠ‚ç‚¹ä¼¸å±•åˆ°æ ¹**ï¼ˆé è¿‘ `k`ï¼‰ã€‚

    > âœ… å¥½å¤„ï¼šå³ä½¿æŸ¥æ‰¾å¤±è´¥ï¼Œä¹Ÿèƒ½æŠŠâ€œæ¥è¿‘ç›®æ ‡â€çš„èŠ‚ç‚¹æ”¾åˆ°æ ¹ï¼Œæ–¹ä¾¿åç»­æ’å…¥ã€‚

    ---

    ### **2ï¸âƒ£ æ’å…¥ï¼ˆInsertï¼‰**

    æ’å…¥é”® `k`ï¼š

    1. æ™®é€š BST æ’å…¥ï¼›
    2. æ’å…¥åï¼Œå°†æ–°èŠ‚ç‚¹ `x` ä¼¸å±•åˆ°æ ¹ã€‚

    ---

    ### **3ï¸âƒ£ åˆ é™¤ï¼ˆDeleteï¼‰**

    åˆ é™¤é”® `k`ï¼š

    1. æŸ¥æ‰¾å¹¶å°†èŠ‚ç‚¹ `x` ä¼¸å±•åˆ°æ ¹ï¼›
    2. åˆ é™¤ `x` åï¼Œå‡è®¾å·¦å­æ ‘ä¸º `L`ã€å³å­æ ‘ä¸º `R`ï¼›
    3. è‹¥ `L` ä¸ä¸ºç©ºï¼Œå°† `L` ä¸­çš„æœ€å¤§èŠ‚ç‚¹ä¼¸å±•åˆ°æ ¹ï¼›
    4. å†å°† `R` è¿æ¥ä¸ºå³å­æ ‘ã€‚

    ---

    ## â± äº”ã€å¤æ‚åº¦åˆ†æ

    | æ“ä½œ | æœ€åæ—¶é—´å¤æ‚åº¦ | æ‘Šè¿˜æ—¶é—´å¤æ‚åº¦ï¼ˆAmortizedï¼‰ |
    | -- | ------- | ------------------ |
    | æŸ¥æ‰¾ | O(n)    | **O(log n)**       |
    | æ’å…¥ | O(n)    | **O(log n)**       |
    | åˆ é™¤ | O(n)    | **O(log n)**       |

    > ğŸ’¡ æ‘Šè¿˜å¤æ‚åº¦åˆ†æç”± Sleator & Tarjan æå‡ºï¼Œä½¿ç”¨**åŠ¿èƒ½åˆ†æï¼ˆPotential Methodï¼‰**è¯æ˜ã€‚

    ---

    ## ğŸ§  å…­ã€Splay Tree çš„ç‰¹ç‚¹

    ### âœ… ä¼˜ç‚¹

    * ä¸éœ€è¦æ˜¾å¼ç»´æŠ¤å¹³è¡¡ä¿¡æ¯ï¼›
    * æ”¯æŒæ‘Šè¿˜ O(log n) çš„æ“ä½œï¼›
    * æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹æ›´å¿«è®¿é—®ï¼›
    * å¯¹**å…·æœ‰è®¿é—®å±€éƒ¨æ€§**çš„åœºæ™¯æ€§èƒ½æå¥½ï¼›
    * å®ç°ç®€å•ã€‚

    ### âŒ ç¼ºç‚¹

    * å•æ¬¡æ“ä½œå¯èƒ½é€€åŒ–åˆ° O(n)ï¼›
    * å¯¹äºæ— è®¿é—®æ¨¡å¼çš„éšæœºæ“ä½œï¼Œæ€§èƒ½ç•¥é€Šäºçº¢é»‘æ ‘ï¼›
    * ä¸ä¿è¯ä¸¥æ ¼å¹³è¡¡ã€‚

    ---

    ## ğŸ§ª ä¸ƒã€åº”ç”¨åœºæ™¯

    * ç¼“å­˜ç³»ç»Ÿï¼ˆLRU-like ç»“æ„ï¼‰
    * æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„ç¼“å­˜ï¼ˆä¾‹å¦‚ UNIX å†…æ ¸ï¼‰
    * åŠ¨æ€é›†åˆã€å­—å…¸
    * è®¿é—®æ¨¡å¼å…·æœ‰**å±€éƒ¨æ€§**çš„æ•°æ®ç»“æ„ä¼˜åŒ–

    ---

    ## ğŸ’» å…«ã€ç¤ºä¾‹ä»£ç ï¼ˆPythonï¼‰

    ä¸‹é¢æ˜¯ä¸€ä»½ç®€åŒ–çš„ Splay Tree å®ç°ï¼š

    ```python
    class Node:
        def __init__(self, key):
            self.key = key
            self.left = None
            self.right = None

    class SplayTree:
        def __init__(self):
            self.root = None

        # ---------- åŸºæœ¬æ—‹è½¬ ----------
        def _right_rotate(self, x):
            y = x.left
            x.left = y.right
            y.right = x
            return y

        def _left_rotate(self, x):
            y = x.right
            x.right = y.left
            y.left = x
            return y

        # ---------- Splay æ“ä½œ ----------
        def _splay(self, root, key):
            if not root or root.key == key:
                return root

            # key åœ¨å·¦å­æ ‘
            if key < root.key:
                if not root.left:
                    return root
                # Zig-Zig
                if key < root.left.key:
                    root.left.left = self._splay(root.left.left, key)
                    root = self._right_rotate(root)
                # Zig-Zag
                elif key > root.left.key:
                    root.left.right = self._splay(root.left.right, key)
                    if root.left.right:
                        root.left = self._left_rotate(root.left)
                return root if not root.left else self._right_rotate(root)

            # key åœ¨å³å­æ ‘
            else:
                if not root.right:
                    return root
                # Zag-Zig
                if key < root.right.key:
                    root.right.left = self._splay(root.right.left, key)
                    if root.right.left:
                        root.right = self._right_rotate(root.right)
                # Zag-Zag
                elif key > root.right.key:
                    root.right.right = self._splay(root.right.right, key)
                    root = self._left_rotate(root)
                return root if not root.right else self._left_rotate(root)

        # ---------- æŸ¥æ‰¾ ----------
        def search(self, key):
            self.root = self._splay(self.root, key)
            return self.root and self.root.key == key

        # ---------- æ’å…¥ ----------
        def insert(self, key):
            if not self.root:
                self.root = Node(key)
                return
            self.root = self._splay(self.root, key)
            if self.root.key == key:
                return  # å·²å­˜åœ¨
            new_node = Node(key)
            if key < self.root.key:
                new_node.right = self.root
                new_node.left = self.root.left
                self.root.left = None
            else:
                new_node.left = self.root
                new_node.right = self.root.right
                self.root.right = None
            self.root = new_node

        # ---------- åˆ é™¤ ----------
        def delete(self, key):
            if not self.root:
                return
            self.root = self._splay(self.root, key)
            if self.root.key != key:
                return
            if not self.root.left:
                self.root = self.root.right
            else:
                temp = self.root.right
                self.root = self._splay(self.root.left, key)
                self.root.right = temp
    ```

    ---

    ## ğŸ“š ä¹ã€å°ç»“

    | ç‰¹æ€§    | è¯´æ˜          |
    | ----- | ----------- |
    | ç»“æ„ç±»å‹  | è‡ªè°ƒæ•´äºŒå‰æœç´¢æ ‘    |
    | å¹³è¡¡ç­–ç•¥  | é€šè¿‡ä¼¸å±•æ“ä½œè‡ªé€‚åº”   |
    | æ—¶é—´å¤æ‚åº¦ | æ‘Šè¿˜ O(log n) |
    | å®ç°å¤æ‚åº¦ | ä¸­ç­‰          |
    | åº”ç”¨ä¼˜åŠ¿  | é€‚åˆå±€éƒ¨æ€§è®¿é—®åœºæ™¯   |

    ---

    æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ ç”»ä¸€ä¸ª**å›¾ç¤ºï¼ˆåŠ¨ç”»å¼ï¼‰ç¤ºæ„ Splay æ“ä½œè¿‡ç¨‹**ï¼Ÿ
    æˆ‘å¯ä»¥ç”Ÿæˆä¸€å¼ å¸¦ç¤ºä¾‹çš„ä¼¸å±•æ ‘å›¾ï¼Œå¸®åŠ©ä½ å½¢è±¡ç†è§£ã€ŒZigã€ã€ŒZig-Zigã€ã€ŒZig-Zagã€ã€‚


### å®šä¹‰ / ç›®æ ‡

ä¿è¯ $m$ æ¬¡æ“ä½œçš„æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(m \log n)$

### åŸºç¡€æ“ä½œ

!!! success "å¤§ä½“æ€è·¯"

    æ€è·¯: å½“æŸ¥è¯¢åˆ°æ—¶é—´æé•¿çš„ï¼ˆä¸€èˆ¬æ˜¯ $O(N)$ï¼‰çš„ï¼Œå°± **é€šè¿‡æ—‹è½¬æ“ä½œæŠŠä»–æ—‹è½¬åˆ°æ ¹èŠ‚ç‚¹**


æœ‰äº›æ“ä½œæ¯”è¾ƒå¿«ï¼ˆè¦æ±‚æ¾ï¼‰ï¼Œæœ‰çš„æ“ä½œæ¯”è¾ƒæ…¢ï¼Œåšåˆ°è¿ç»­ M æ¬¡æ“ä½œæœ€å¤š $O(M \log n)$

å½“ä¸€ä¸ªèŠ‚ç‚¹è¢«è®¿é—®ï¼ˆæ—¶é—´è¶…è¿‡æŸä¸ªé˜ˆå€¼ï¼‰ï¼Œå°±é€šè¿‡ AVL çš„æ—‹è½¬ä½¿å¾—å…¶åˆ°æ ¹èŠ‚ç‚¹ï¼ˆ push to the rootï¼‰

![alt text](res/images/image-5.png)

![alt text](res/images/image-6.png)

**çœ‹ä¸€ä¸ªèŠ‚ç‚¹ Xã€å…¶çˆ¶äº² Pï¼Œå’Œå…¶ç¥–çˆ¶ Gï¼š**

zig-zigï¼šä¸€æ¡çº¿

- X æ˜¯ P çš„å·¦å­æ ‘ï¼ŒP æ˜¯ G çš„å·¦å­æ ‘ï¼šä¸¤æ¬¡å•æ—‹ï¼Œå…ˆ P & Gï¼Œå† X & P
- X æ˜¯ P çš„å³å­æ ‘ï¼ŒP æ˜¯ G çš„å³å­æ ‘ï¼šä¸¤æ¬¡å•æ—‹

zig-zagï¼šæ‹ä¸€ä¸‹

!!! abstract "è¯¾ä¸‹æ€»ç»“"

    æŒ‰ç…§ AVL çš„æ–¹æ³•æ—‹è½¬

- X æ˜¯ P çš„å³å­æ ‘ï¼ŒP æ˜¯ G çš„å·¦å­æ ‘ï¼šä¸€æ¬¡åŒæ—‹ï¼Œå·¦æ—‹ Pï¼Œå†å³æ—‹ G
- X æ˜¯ P çš„å·¦å­æ ‘ï¼ŒP æ˜¯ G çš„å³å­æ ‘ï¼šä¸€æ¬¡åŒæ—‹ï¼Œå³æ—‹ Pï¼Œå†å·¦æ—‹ G

![alt text](res/images/image-7.png)

!!! abstract "è¯¾ä¸‹æ€»ç»“"

    é€šè¿‡å‡ æ¬¡æ—‹è½¬ï¼ˆzig-zig / zig-zagï¼‰æŠŠè¢«æŸ¥è¯¢çš„ X æ—‹è½¬åˆ°æ ¹èŠ‚ç‚¹

### åˆ é™¤

!!! abstract "è¯¾ä¸‹æ€»ç»“"

    ä¿è¯åˆ é™¤åæ ‘ä¾ç„¶æ˜¯ BST

![alt text](res/images/image-8.png)

### Spray Tree & AVL Tree å¯¹æ¯”

|               | AVL Tree               | Spray Tree                      |
| ------------- | ---------------------- | ------------------------------- |
| ä¼˜ç‚¹        |                  | æ ‘é«˜ä½                  |
| ç¼ºç‚¹        | æ¯æ¬¡éƒ½æ—‹è½¬           | å¤šä¸€ä¸ªpush to root                          |

|               | AVL Tree               | Spray Tree                      |
| ------------- | ---------------------- | ------------------------------- |
| å¹³è¡¡æ€§        | ä¸¥æ ¼å¹³è¡¡               | æ¾æ•£å¹³è¡¡                        |
| æ—‹è½¬æ¬¡æ•°      | æ¯æ¬¡æ’å…¥/åˆ é™¤å¯èƒ½æ—‹è½¬   | ä¸æ˜¯æ¯æ¬¡éƒ½è¦| æ¯æ¬¡è®¿é—®å¯èƒ½æ—‹è½¬å¤šæ¬¡            |
| å•æ¬¡æ“ä½œæ—¶é—´  | $O(\log n)$           | ä¸èƒ½ä¿è¯                     |
| å¤šæ¬¡æ“ä½œæ—¶é—´ | $O(M \log n)$          | $O(M \log n)$                   |


## Amortized Analysis

æ¦‚å¿µï¼šæ‘Šé”€åˆ†ææ˜¯ä¸€ç§é€šè¿‡è€ƒè™‘ä¸€ç³»åˆ—æ“ä½œçš„æ€»æˆæœ¬æ¥å¹³æ‘Šå•ä¸ªæ“ä½œçš„æˆæœ¬ï¼Œä»è€Œå¾—å‡ºæ›´ç²¾ç¡®çš„æ—¶é—´å¤æ‚åº¦çš„æ–¹æ³•ã€‚

![alt text](res/images/image-9.png)


æ€æƒ³ï¼š$n$ ä¸ªæ“ä½œèŠ±æ—¶é—´ä¸º $T(n)$ï¼ŒIn the worse case, amortised cose is $T(n) / n$

Example: on an initially 

!!! success ""

    We can pop each object from the stack at most once for each time we have pushed it onto the stack


### Accouting Method

![alt text](res/images/image-10.png)

è®¡ç®—æ–¹æ³•ï¼šå°†æ‰€æœ‰æ—¶é—´åŠ èµ·æ¥ï¼Œé™¤ä»¥ n

ä»¥ multipop ä¸¾ä¾‹ï¼Œåªæœ‰ push æ‰èƒ½ popï¼Œpush æ—¶å­˜ä¸€ä¸ª 1 çš„ credit

### Potential method åŠ¿èƒ½æ³•

![alt text](res/images/image-12.png)

æœ€å…³é”®çš„æ˜¯ $D_i$ $D_i$ çš„å®šä¹‰

ç”¨ Potential method å¯ä»¥è®¡ç®— accounting method çš„ creditï¼Œç»§è€Œç®— amortized time

ä¸¾ä¾‹ï¼šSplay Tree

![alt text](res/images/image-11.png)

é¦–å…ˆè¦é€‰å–åŠ¿èƒ½å‡½æ•°ï¼šæ¯æ¬¡æ—‹è½¬æ“ä½œåï¼Œå‘ç”Ÿå˜åŒ–çš„åªæœ‰ X / P / G çš„å­æ ‘çš„èŠ‚ç‚¹æ•°ï¼Œå…¶ä»–nodeçš„å­æ ‘çš„èŠ‚ç‚¹æ•°ä¸å˜ï¼›å¦å¤–ï¼Œç”±å±€éƒ¨æ€§åŸç†ï¼šrank åªä¸å±€éƒ¨æœ‰å…³ï¼ˆX / P / Gï¼‰ï¼Œä½¿å¾— rank çš„è®¡ç®—ç®€å•äº æ ‘é«˜ heightã€‚

!!! info ""

    rank(node) = log(size of subtree) çº¦ç­‰äº Height of subtree

    rank(X) = log|size(X)| åªä¾èµ–äºï¼š
    - X çš„å­æ ‘å¤§å°
    - åœ¨æ—‹è½¬æ—¶ï¼Œåªæœ‰ Xã€Pã€G ä¸‰ä¸ªèŠ‚ç‚¹çš„ rank ä¼šå˜åŒ–
    - å…¶ä»–èŠ‚ç‚¹çš„ rank ä¿æŒä¸å˜

!!! quote ""

    Lemma: if a + b < c, then log(a) + log(b) < 2log(c) - 2


![alt text](res/images/1f5b5b0f98742aab7d9da213b64d1201.jpg)

é€šè¿‡ä¸Šé¢å¼•ç†ï¼Œå¯ä»¥æ”¾ç¼©ï¼Œè¿›è€Œå°†å…¶éƒ½æ”¾ç¼©æˆ3å€çš„ï¼Œä¸”æ¯æ¬¡æ“ä½œä¸Šä¸€æ¬¡å‡çš„é¡¹å’Œä¸‹ä¸€æ¬¡åŠ çš„é¡¹å¯ä»¥è£‚é¡¹ç›¸æ¶ˆï¼Œè¿›è€Œå°±å‰©ä¸‹ log(n) çº§åˆ«çš„é¡¹ï¼ˆæ ¹èŠ‚ç‚¹çš„ rankï¼Œbasically height of the treeï¼‰

